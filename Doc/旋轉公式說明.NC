% 

//A(#1) => 被旋轉點X座標 X 
//B(#2) => 被旋轉點Y座標 Y 
//C(#3) => 被旋轉點Z座標 Z 
//F(#9) => 旋轉中心點X座標 OX 
//S(#19) => 旋轉中心點Y座標 OY 
//U(#21) => 旋轉中心點Z座標 OZ 
//V(#22) => 旋轉角度 XZθ
//W(#23) => 旋轉角度 YZθ

//==================================================

//被旋轉點X座標 X -> @101
//@101 = -4.494;
//被旋轉點Y座標 Y -> @102
//@102 = -28.897;
//被旋轉點Z座標 Z -> @103
//@103 = 20.284;

=======================================================

//旋轉中心點X座標 OX -> @104
//旋轉中心點Y座標 OY -> @105
//旋轉中心點Z座標 OZ -> @106
=======================================================

//#107 => 被旋轉點新X座標 X2
//#108 => 被旋轉點新Y座標 Y2
//#109 => 被旋轉點新Z座標 Z2

//=====================================================

//XZ平面翻-3度,YZ平面翻2度
//旋轉角度 θXZ -> @110
@110 = -3.0;
//旋轉角度 θYZ -> @111
@111 = 2.0;

//=====================================================

//需要按照順序

//先在XZ平面做旋轉，找出被旋轉點新的X,Z座標
//X2    = (   x    -   OX   )  *  COS(XZθ)   - (    Z    -    OZ    )  *   SIN(XZθ)   +  OX 
//#107  = ( A(#1)  -  F(#9) )  * COS[V(#22)] - (  C(#3)  -  U(#21)  )  *  SIN[V(#22)] + F(#9);
//Z2    = (   x    -   OX   )  *  SIN(XZθ)   + (    Z    -    OZ    )  *   COS(XZθ)   +  OZ 
//#109  = ( A(#1)  -  F(#9) )  * SIN[V(#22]  + (  C(#3)  -  U(#21)  )  *  COS[V(#22]  + U(#21);

//接著再在YZ平面做旋轉，找出被旋轉點新的Y,Z座標，Z座標要以被旋轉後的新Z座標帶入
//Y2    = (   Y    -    OY   )  *  COS(YZθ)     - (   Z2  -   OZ   )  *  SIN(YZθ)    +   OY 
//#108  = ( B(#2)  -  S(#19) )  * COS[W(#23)]   - ( #109 - U(#21) )  * SIN[W(#23)]  +  S(#19);
//Z3    = (   Y    -    OY   )  *  SIN(YZθ)     + (   Z2  -   OZ   )  *  COS(YZθ)    +   OZ 
//#109  = ( B(#2)  -  S(#19) )  * SIN[W(#23)]   + ( #109 - U(#21) )  * COS[W(#23)]  +  U(#21);

=================================================================================================

//以上公式，合併整理成以下：

//被旋轉後點X座標#1 = ( 被旋轉前點X座標 - 旋轉中心點X座標 ) * COS[在XZ平面旋轉的角度] - ( 被旋轉前點Z座標 - 旋轉中心點Z座標 ) * SIN[在XZ平面旋轉的角度] + 旋轉中心點X座標  
//被旋轉後點Y座標#2 = ( 被旋轉前點Y座標 - 旋轉中心點Y座標 ) * COS[在YZ平面旋轉的角度] - ( ( 被旋轉前點X座標 - 旋轉中心點X座標 ) * SIN[在XZ平面旋轉的角度] + ( 被旋轉前點Z座標 - 旋轉中心點Z座標 ) * COS[在XZ平面旋轉的角度] + 旋轉中心點Z座標  - 旋轉中心點Z座標 ) * SIN[在YZ平面旋轉的角度] + 旋轉中心點Y座標 
//被旋轉後點Z座標#3 = ( 被旋轉前點Y座標 - 旋轉中心點Y座標 ) * SIN[在YZ平面旋轉的角度] + ( ( 被旋轉前點X座標 - 旋轉中心點X座標 ) * SIN[在XZ平面旋轉的角度] + ( 被旋轉前點Z座標 - 旋轉中心點Z座標 ) * COS[在XZ平面旋轉的角度] + 旋轉中心點Z座標  - 旋轉中心點Z座標 ) * COS[在YZ平面旋轉的角度] + 旋轉中心點Z座標


//X2= (    x    -   OX   ) *  COS(XZθ)   - (    Z    -    OZ   )  *   SIN(XZθ)   +  OX         
// X( (  A(#1)  -  F(#9) ) * COS[V(#22)] - (  C(#3)  -  U(#21) )  *  SIN[V(#22)] + F(#9) )   

//Y2= (    Y    -    OY   )  *  COS(YZθ)   - ( Z2=(    x    -    OX  )  *  SIN(XZθ)  + (    Z    -    OZ    )  *   COS(XZθ)   +   OZ   -  OZ    )  *  SIN(YZθ)    +    OY
//Y(  (  B(#2)  -  S(#19) )  * COS[W(#23)] - (    (  A(#1)  -  F(#9) )  * SIN[V(#22] + (  C(#3)  -  U(#21)  )  *  COS[V(#22]  + U(#21) - U(#21) )  * SIN[W(#23)]  +  S(#19))

//Z3= (    Y    -    OY   )  *  SIN(YZθ)   + ( Z2=(    x    -   OX   )  *  SIN(XZθ)  + (    Z    -    OZ    )  *   COS(XZθ)   +   OZ   -  OZ    )  *  COS(YZθ)    +    OZ  
//Z(  (  B(#2)  -  S(#19) )  * SIN[W(#23)] + (    (  A(#1)  -  F(#9) )  * SIN[V(#22] + (  C(#3)  -  U(#21)  )  *  COS[V(#22]  + U(#21) - U(#21) )  * COS[W(#23)]  +  U(#21) );


//被旋轉點X(-4.494)Y(-28.897)Z(20.284)
//被旋轉點在XZ平面轉的結果-4.5,-28.89,20.05
//被旋轉點在YZ平面轉的結果-4.5,-28.87,21.06
//塊料長寬高X : 90  Y : 55 Z : 40 -> 旋轉中心點0,0,20
//XZ平面翻-3度,YZ平面翻2度


===============================================================================================
M99;
%